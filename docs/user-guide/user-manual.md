# CAJanus 用户手册

> 📖 **完整功能指南** - 详细的功能使用说明和最佳实践

## 📋 目录

1. [软件概述](#软件概述)
2. [核心功能](#核心功能)
3. [高级功能](#高级功能)
4. [设置配置](#设置配置)
5. [最佳实践](#最佳实践)
6. [安全须知](#安全须知)
7. [版本更新记录](#版本更新记录)

> 💡 **新用户提示**：如果您是第一次使用，建议先阅读 [快速入门指南](quick-start.md)

---

## 软件概述

### 项目简介
CAJanus是一款专为教学和研究设计的跨平台设备指纹识别与修改工具。它帮助用户理解设备指纹技术的工作原理，严格遵循教育目的，提供安全可靠的学习环境。

### 核心特性
- 🔍 **设备指纹识别**：检测网络适配器、硬件信息等设备标识
- 🛡️ **安全修改功能**：在严格确认流程下修改设备标识符
- 💾 **备份与恢复**：完整的数据备份和恢复机制
- 📊 **系统状态监控**：实时显示系统信息和性能指标
- 📚 **教育功能**：详细的操作原理说明和学习资源

### 设计理念
- **教育优先**：所有功能都以教学和研究为目的
- **安全第一**：多重确认机制和完整的备份保护
- **用户友好**：直观的界面设计和详细的操作指导
- **跨平台支持**：支持Windows、macOS和Linux系统

---

## 核心功能

### 系统状态监控

#### 功能概述
系统状态监控提供实时的系统信息展示，帮助用户了解当前系统状态。

#### 主要信息
- **操作系统信息**：OS名称、版本、架构、启动时间
- **权限状态**：管理员权限、文件系统权限、注册表权限
- **性能监控**：CPU使用率、内存使用、磁盘空间

#### 使用方法
1. 切换到"系统状态"标签页
2. 查看各项系统信息
3. 点击"刷新"按钮更新数据
4. 使用"导出"功能保存系统信息

### 设备指纹识别

#### 网络适配器信息
- **适配器列表**：显示所有网络适配器
- **详细信息**：MAC地址、IP地址、连接状态、适配器类型
- **实时状态**：动态更新连接状态和IP分配

#### 硬件信息
- **机器标识**：机器GUID、主板序列号
- **硬件详情**：CPU信息、内存配置、磁盘信息
- **系统特征**：启动时间、系统版本、用户信息

#### 操作步骤
1. 切换到"设备指纹"标签页
2. 选择要查看的信息类别
3. 点击"刷新"获取最新信息
4. 使用"复制"功能复制特定信息

### 备份与恢复

#### 备份类型
- **完整备份**：备份所有系统配置和设备信息
- **增量备份**：仅备份变更的部分
- **选择性备份**：选择特定项目进行备份

#### 备份流程
1. 切换到"备份管理"标签页
2. 点击"创建备份"按钮
3. 选择备份类型和存储位置
4. 配置备份选项
5. 执行备份操作

#### 恢复流程
1. 在备份列表中选择要恢复的备份
2. 点击"恢复备份"按钮
3. 确认恢复选项
4. 执行恢复操作

### 教育功能

#### 技术原理
- **设备指纹概念**：详细解释设备指纹的定义和用途
- **识别技术**：介绍各种设备识别技术的原理
- **修改原理**：说明设备标识符修改的技术原理

#### 学习资源
- **操作指南**：分步骤的详细操作说明
- **最佳实践**：推荐的操作方法和经验分享
- **参考资料**：相关技术文档和学习资源链接

---

## 高级功能

### 三级确认系统

#### 确认流程
CAJanus采用三级确认系统确保操作安全：

1. **基础确认**：显示操作信息和风险等级
2. **风险确认**：详细说明操作风险和前置条件
3. **最终确认**：确认操作后果和恢复方案

#### 风险等级
- 🟢 **低风险**：对系统影响较小的操作
- 🟡 **中等风险**：可能影响系统稳定性的操作
- 🟠 **高风险**：可能导致系统问题的操作
- 🔴 **严重风险**：可能导致系统无法启动的操作

### 安全修改功能

#### MAC地址修改
1. 在设备指纹页面选择网络适配器
2. 点击"修改MAC地址"按钮
3. 输入新的MAC地址
4. 通过三级确认流程
5. 系统自动执行修改和验证

#### 机器GUID修改
1. 在硬件信息区域找到机器GUID
2. 点击"修改GUID"按钮
3. 生成或输入新的GUID
4. 通过严格的确认流程
5. 重启系统使修改生效

### 帮助系统

#### 快速帮助
- **常用功能**：快速访问常用帮助主题
- **搜索功能**：快速搜索帮助内容
- **最近查看**：显示最近查看的帮助内容

#### 详细帮助
- **功能说明**：每个功能的详细使用说明
- **故障排除**：常见问题的解决方案
- **FAQ**：常见问题解答

---

## 设置配置

### 常规设置

#### 应用程序设置
- **启动选项**：程序启动时的行为设置
- **界面语言**：选择界面显示语言（中文/英文/繁体中文/日语）
- **主题设置**：选择界面主题和颜色方案
- **字体设置**：调整界面字体大小和样式

#### 功能设置
- **自动刷新**：设置数据自动刷新间隔
- **工具提示**：启用或禁用工具提示显示
- **确认对话框**：设置操作确认的级别

### 安全设置

#### 操作确认
- **三级确认**：启用或禁用三级确认系统
- **风险警告**：设置风险警告的显示级别
- **操作日志**：启用详细的操作日志记录

#### 备份设置
- **自动备份**：设置修改前的自动备份
- **备份路径**：设置备份文件的存储位置
- **备份保留**：设置备份文件的保留策略

### 高级设置

#### 性能优化
- **缓存设置**：启用数据缓存以提高性能
- **并行处理**：启用多线程处理
- **内存管理**：设置内存使用限制

#### 无障碍功能
- **键盘导航**：启用完整的键盘导航支持
- **高对比度**：启用高对比度显示模式
- **屏幕阅读器**：启用屏幕阅读器支持

---

## 最佳实践

### 使用建议

#### 首次使用
1. **环境检查**：运行环境检查工具确保系统兼容
2. **权限确认**：确保具有必要的系统权限
3. **创建备份**：在进行任何修改前先创建完整备份
4. **测试环境**：建议在测试环境中先熟悉功能

#### 日常使用
1. **定期备份**：定期创建系统备份
2. **权限管理**：仅在必要时使用管理员权限
3. **日志查看**：定期查看操作日志
4. **版本更新**：及时更新到最新版本

### 安全建议

#### 操作安全
- **授权使用**：仅在您拥有或获得授权的设备上使用
- **测试优先**：在生产环境使用前先在测试环境验证
- **备份验证**：定期验证备份文件的完整性
- **权限最小化**：使用最小必要权限原则

#### 数据安全
- **敏感信息**：妥善保护备份文件中的敏感信息
- **访问控制**：限制对配置文件和日志的访问
- **定期清理**：定期清理临时文件和过期日志

---

## 安全须知

### 法律合规

#### 使用限制
- **教育目的**：本工具仅供教育和研究使用
- **授权环境**：仅在您拥有或获得明确授权的设备上使用
- **法律遵守**：遵守当地法律法规和相关政策
- **责任自负**：用户对使用本工具的后果承担全部责任

#### 禁止行为
- ❌ 用于任何非法或恶意目的
- ❌ 在未授权的设备上使用
- ❌ 用于商业目的
- ❌ 绕过安全措施或访问控制

### 风险提醒

#### 操作风险
- **系统稳定性**：修改操作可能影响系统稳定性
- **网络连接**：MAC地址修改可能导致网络连接中断
- **系统启动**：某些修改可能影响系统正常启动
- **数据丢失**：不当操作可能导致数据丢失

#### 缓解措施
- **备份保护**：修改前自动创建备份
- **确认流程**：三级确认系统防止误操作
- **恢复机制**：完整的数据恢复功能
- **日志记录**：详细的操作日志便于问题追踪

---

## 获取帮助

### 内置帮助
- **F1键**：随时按F1键打开帮助系统
- **工具提示**：鼠标悬停查看控件说明
- **状态栏**：查看当前操作状态和提示

### 在线资源
- 📖 [安装指南](installation.md)
- 🚀 [快速入门](quick-start.md)
- ❓ [常见问题](faq.md)
- 🔧 [故障排除](troubleshooting.md)

### 技术支持
- **GitHub Issues**：https://github.com/your-repo/CAJanus/issues
- **社区讨论**：https://github.com/your-repo/CAJanus/discussions
- **邮箱支持**：support@example.com

---

## 版本更新记录

### v1.1.0 (2025年7月26日) - 重大功能修复与优化

本版本进行了全面的功能修复和用户体验优化，解决了多个关键问题并增强了系统稳定性。

#### 🔧 核心问题修复

##### 1. 设备指纹识别功能修复
**问题**: `'WindowsFingerprintManager' object has no attribute 'get_volume_serials'`
- **原因**: UI代码调用了不存在的方法名
- **修复**: 统一方法名为 `get_volume_serial_numbers()`
- **影响**: 修复了 `src/ui/fingerprint_widget.py` 和 `src/ui/backup_widget.py` 中的调用

##### 2. 网络适配器属性访问修复
**问题**: `'NetworkAdapter' object has no attribute 'is_modified'` 和 `'is_enabled'`
- **原因**: UI代码访问了NetworkAdapter类中不存在的属性
- **修复**:
  - 移除 `is_modified` 检查，添加TODO注释
  - 将 `is_enabled` 替换为使用 `status` 属性
  - 更新了状态显示逻辑，支持多种状态值
- **影响**: 修复了指纹识别、备份管理、MAC地址对话框中的显示问题

##### 3. 多线程竞态条件修复
**问题**: `'NoneType' object has no attribute 'setLabelText'`
- **原因**: 进度对话框在多线程环境中的竞态条件
- **修复**:
  - 改进了 `on_progress_updated` 方法的空值检查
  - 添加了异常处理捕获 `AttributeError` 和 `RuntimeError`
  - 增强了 `on_worker_finished` 方法的清理逻辑
- **影响**: 提升了系统稳定性，避免了界面崩溃

#### 📋 菜单功能完善

##### 1. 文件菜单功能实现
**修复内容**:
- **新建配置**: 实现了完整的配置重置功能，包含用户确认对话框
- **打开配置**: 支持YAML和JSON格式的配置文件加载
- **保存配置**: 支持多种格式的配置文件导出
- **格式兼容**: 统一了配置文件格式处理，YAML格式优先

**技术改进**:
```python
# 支持多种配置文件格式
if file_path.lower().endswith('.json'):
    json.dump(self.config, f, ensure_ascii=False, indent=2)
else:
    yaml.dump(self.config, f, default_flow_style=False, allow_unicode=True)
```

##### 2. 工具菜单功能增强
**修复内容**:
- **系统信息**: 实现了详细的系统信息显示，包括硬件、内存、磁盘信息
- **权限检查**: 完整的权限检查报告和建议
- **设置功能**: 完善了所有29个配置项的实现

**功能特性**:
- 跨平台系统信息获取
- 详细的权限状态报告
- 友好的错误处理和用户提示

##### 3. 帮助系统功能修复
**问题**: 快速链接按钮无响应
- **原因**: 父控件查找逻辑错误
- **修复**: 改进了控件查找机制，添加了备用方案
- **增强**: 完善了"学习资源"帮助内容，包含技术文档、实践指导、参考资料

#### ⚙️ 设置系统优化

##### 1. 配置键值映射修复
**问题**: UI显示值与配置存储值不匹配
- **主题映射**: `default` ↔ `默认`, `dark` ↔ `深色`
- **语言映射**: `zh_CN` ↔ `简体中文`, `en_US` ↔ `English`
- **实现**: 双向映射机制，加载时转换为显示值，保存时转换为配置值

##### 2. 设置功能完整性
**实现内容**:
- **29个配置项**: 涵盖常规、安全、高级设置
- **3个标签页**: 清晰的功能分类
- **4个操作按钮**: 确定、应用、取消、重置功能完整
- **格式支持**: YAML和JSON格式完全兼容

#### 💾 备份系统重大改进

##### 1. 时间处理标准化
**修复内容**:
- **多格式时间戳**: 文件名用紧凑格式，数据用ISO格式，界面用可读格式
- **时间解析优先级**: 可读时间戳 → ISO时间戳 → 文件名解析 → 文件修改时间
- **向后兼容**: 支持旧格式备份文件的时间解析

**技术实现**:
```python
current_time = datetime.now()
timestamp_for_filename = current_time.strftime("%Y%m%d_%H%M%S")
timestamp_iso = current_time.isoformat()
timestamp_readable = current_time.strftime("%Y-%m-%d %H:%M:%S")
```

##### 2. 备份历史显示修复
**问题**: 备份目录显示为空
- **原因**: `load_backup_history()` 方法逻辑错误
- **修复**: 改进了控制流，确保表格更新代码总是执行
- **增强**: 实现了真实的备份文件扫描和解析

##### 3. 备份管理功能完善
**新增功能**:
- **查看备份**: 在文件管理器中打开备份目录（修复了路径问题）
- **删除备份**: 安全删除选中的备份文件，包含确认对话框
- **快速恢复**: 自动选择最新备份进行恢复
- **导出备份**: 将备份文件导出到指定位置，包含完整性验证

**错误处理优化**:
```python
# Windows系统特殊处理
if system == "Windows":
    result = subprocess.run(['explorer', win_path],
                          capture_output=True, text=True, timeout=5)
    success = True  # Explorer启动即成功，不检查返回码
```

##### 4. 设备指纹功能修复
**网络适配器功能修复**:
- **刷新功能**: 修复了空实现问题，实现完整的适配器列表刷新
  - 支持父控件数据自动更新
  - 添加了完善的错误处理机制
  - 递归查找父控件的刷新方法
- **恢复功能**: 修复了占位符实现，支持原始MAC地址恢复
  - 实现了完整的MAC地址恢复流程
  - 添加了操作确认对话框和风险提示
  - 集成了权限检查和结果反馈

**硬件信息功能修复**:
- **GUID恢复**: 修复了占位符实现，支持智能恢复策略
  - 实现了平台兼容性检查
  - 支持备份恢复的替代方案
  - 添加了详细的风险警告和操作指导
- **卷序列号修改**: 修复了占位符实现，支持完整的修改流程
  - 实现了8位十六进制格式验证
  - 添加了平台兼容性检查
  - 支持操作确认和结果反馈
- **网络适配器显示**: 修复了适配器名称不显示的问题
  - 优化了WMI命令查询和字段解析逻辑
  - 添加了动态标题行解析和备用获取方法
  - 实现了MAC地址格式标准化
  - 改进了适配器名称的降级处理机制

##### 5. 教育功能UI优化
**界面统一性改进**:
- **操作指导界面**: 改为与原理解释一致的树形+分割器布局
- **学习资源界面**: 改为与原理解释一致的树形+分割器布局
- **三个标签页**: 现在使用统一的UI风格和交互方式

**内容质量提升**:
- **操作指导**: 内容更加详细和结构化，支持Markdown格式
- **学习资源**: 资源更加丰富和实用，包含技术文档、教程和工具
- **技术细节**: 添加了更多实际的技术细节和最佳实践

**用户体验改进**:
- **统一布局**: 分割器布局提供一致的用户体验
- **树形导航**: 便于内容查找和浏览
- **动态标题**: 清晰显示当前选择的内容
- **样式优化**: 文本区域样式更加美观易读

**技术实现**:
```python
# 网络适配器刷新
def refresh_adapters(self):
    parent_widget = self.parent()
    while parent_widget and not hasattr(parent_widget, 'refresh_all_data'):
        parent_widget = parent_widget.parent()

    if parent_widget:
        parent_widget.refresh_all_data()

# MAC地址恢复
def restore_mac_address(self):
    success = fingerprint_manager.restore_original_mac(adapter.adapter_id)
    if success:
        self.refresh_adapters()

# GUID智能恢复
def restore_guid(self):
    if 'restore_original_guid' not in supported_ops:
        # 检查备份文件，提供备份恢复选项
        self.show_backup_restore()
```

#### 📁 Registry备份系统说明

##### Registry目录结构
```
backups/
├── backup_*.bak          # 主备份文件(JSON格式)
└── registry/
    └── registry_*.json   # 注册表备份文件
```

##### Registry文件作用
- **精确备份**: 存储具体的Windows注册表键值对数据
- **自动触发**: 每次修改注册表前自动创建
- **精确恢复**: 支持恢复到任意历史状态
- **数据完整**: 包含备份ID、时间戳、注册表路径和所有值

#### 🛠️ 技术架构改进

##### 1. 错误处理机制
- **分层异常处理**: 不同层级的异常有不同的处理策略
- **用户友好提示**: 技术错误转换为用户可理解的信息
- **降级方案**: 主要功能失败时提供备选方案

##### 2. 跨平台兼容性
- **系统特定处理**: 针对Windows/macOS/Linux的特殊处理
- **命令执行优化**: 改进了外部命令的执行和错误处理
- **路径处理**: 统一的路径处理机制

##### 3. 配置管理优化
- **格式自动识别**: 根据文件扩展名自动选择解析格式
- **向后兼容**: 支持旧版本配置文件的加载
- **数据验证**: 配置加载时的完整性检查

#### 📊 性能与稳定性提升

##### 1. 内存管理
- **资源清理**: 改进了线程和对话框的资源清理
- **异常安全**: 确保异常情况下资源正确释放

##### 2. 界面响应性
- **异步操作**: 长时间操作使用工作线程
- **进度反馈**: 详细的操作进度显示
- **用户体验**: 操作过程中的实时状态更新

##### 3. 数据完整性
- **备份验证**: 备份创建和恢复时的数据验证
- **文件完整性**: 导出操作的文件大小验证
- **错误恢复**: 操作失败时的状态恢复机制

#### 🎯 用户体验优化

##### 1. 界面改进
- **按钮命名**: 更清晰的按钮标签和功能描述
- **操作反馈**: 详细的操作结果提示
- **错误提示**: 友好的错误信息和解决建议

##### 2. 安全机制
- **操作确认**: 所有危险操作都有确认对话框
- **数据保护**: 完整的备份和恢复机制
- **权限检查**: 操作前的权限验证

##### 3. 功能完整性
- **菜单功能**: 所有菜单项都有实际功能
- **设置选项**: 29个配置项全部可用
- **帮助系统**: 完整的帮助内容和学习资源

---

**版本信息**：v1.1.0
**最后更新**：2025年7月26日
**文档维护**：CAJanus开发团队
