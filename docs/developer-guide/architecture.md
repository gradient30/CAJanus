# CAJanus æ¶æ„è®¾è®¡æ–‡æ¡£

> ğŸ“ **ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡åŸç†** - æ·±å…¥ç†è§£CAJanusçš„æŠ€æœ¯æ¶æ„

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†CAJanusé¡¹ç›®çš„ç³»ç»Ÿæ¶æ„ã€è®¾è®¡åŸç†å’ŒæŠ€æœ¯å®ç°ã€‚

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒè®¾è®¡åŸåˆ™](#æ ¸å¿ƒè®¾è®¡åŸåˆ™)
3. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
4. [æ¨¡å—è®¾è®¡](#æ¨¡å—è®¾è®¡)
5. [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
6. [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
7. [æ€§èƒ½è®¾è®¡](#æ€§èƒ½è®¾è®¡)
8. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿå®šä½
CAJanusæ˜¯ä¸€ä¸ªä¸“ä¸ºæ•™è‚²å’Œç ”ç©¶è®¾è®¡çš„è·¨å¹³å°è®¾å¤‡æŒ‡çº¹è¯†åˆ«ä¸ä¿®æ”¹å·¥å…·ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒWindowsã€macOSå’ŒLinuxä¸‰å¤§æ“ä½œç³»ç»Ÿã€‚

### æŠ€æœ¯æ ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚ (Application)           â”‚
â”‚  Python 3.8+ | PyQt5 | æ•™è‚²å·¥å…·        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ¡†æ¶å±‚ (Framework)            â”‚
â”‚  é…ç½®ç®¡ç† | æ—¥å¿—ç³»ç»Ÿ | å›½é™…åŒ– | æµ‹è¯•     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           å¹³å°å±‚ (Platform)             â”‚
â”‚  Windows API | macOS API | Linux API   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç³»ç»Ÿå±‚ (System)               â”‚
â”‚  æ“ä½œç³»ç»Ÿ | ç¡¬ä»¶é©±åŠ¨ | ç½‘ç»œæ ˆ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç‰¹æ€§
- **è·¨å¹³å°æ”¯æŒ**ï¼šç»Ÿä¸€çš„APIæŠ½è±¡ï¼Œæ”¯æŒå¤šæ“ä½œç³»ç»Ÿ
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šé«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—ç»“æ„
- **å®‰å…¨ä¼˜å…ˆ**ï¼šå¤šé‡ç¡®è®¤æœºåˆ¶å’Œå®Œæ•´å¤‡ä»½ä¿æŠ¤
- **æ•™è‚²å¯¼å‘**ï¼šä¸“ä¸ºæ•™å­¦å’Œç ”ç©¶è®¾è®¡çš„åŠŸèƒ½

---

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (SRP)
æ¯ä¸ªæ¨¡å—å’Œç±»éƒ½æœ‰æ˜ç¡®çš„å•ä¸€èŒè´£ï¼š
- `ConfigManager`ï¼šä¸“é—¨è´Ÿè´£é…ç½®ç®¡ç†
- `FingerprintEngine`ï¼šä¸“é—¨è´Ÿè´£è®¾å¤‡æŒ‡çº¹è¯†åˆ«
- `BackupManager`ï¼šä¸“é—¨è´Ÿè´£å¤‡ä»½å’Œæ¢å¤

### 2. å¼€é—­åŸåˆ™ (OCP)
ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š
- é€šè¿‡æ¥å£å®šä¹‰è¡Œä¸ºè§„èŒƒ
- é€šè¿‡å·¥å‚æ¨¡å¼æ”¯æŒæ–°å¹³å°æ‰©å±•
- é€šè¿‡æ’ä»¶æœºåˆ¶æ”¯æŒåŠŸèƒ½æ‰©å±•

### 3. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡ï¼š
```python
# æŠ½è±¡æ¥å£
class IFingerprintEngine(ABC):
    @abstractmethod
    def get_network_adapters(self) -> List[NetworkAdapter]:
        pass

# å…·ä½“å®ç°
class WindowsFingerprintEngine(IFingerprintEngine):
    def get_network_adapters(self) -> List[NetworkAdapter]:
        # Windowsç‰¹å®šå®ç°
        pass
```

### 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)
å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼š
- å°†å¤§æ¥å£æ‹†åˆ†ä¸ºå¤šä¸ªå°æ¥å£
- æ¯ä¸ªæ¥å£ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½é¢†åŸŸ

---

## ç³»ç»Ÿæ¶æ„

### åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚ (Presentation)                 â”‚
â”‚  MainWindow | Dialogs | Widgets | Styles               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åº”ç”¨å±‚ (Application)                  â”‚
â”‚  Controllers | Services | Validators                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡å±‚ (Business)                     â”‚
â”‚  FingerprintEngine | BackupManager | PermissionManager â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å¹³å°å±‚ (Platform)                     â”‚
â”‚  WindowsPlatform | MacOSPlatform | LinuxPlatform       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€å±‚ (Infrastructure)               â”‚
â”‚  ConfigManager | Logger | I18nManager | DataModels     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ä¾èµ–å…³ç³»
```mermaid
graph TD
    A[UI Layer] --> B[Application Layer]
    B --> C[Business Layer]
    C --> D[Platform Layer]
    D --> E[Infrastructure Layer]
    
    B --> F[ConfigManager]
    B --> G[Logger]
    B --> H[I18nManager]
    
    C --> I[FingerprintEngine]
    C --> J[BackupManager]
    C --> K[PermissionManager]
    
    D --> L[WindowsPlatform]
    D --> M[MacOSPlatform]
    D --> N[LinuxPlatform]
```

---

## æ¨¡å—è®¾è®¡

### æ ¸å¿ƒæ¨¡å—æ¶æ„

#### é…ç½®ç®¡ç†æ¨¡å—
```python
class ConfigManager:
    """é…ç½®ç®¡ç†å™¨ - ç»Ÿä¸€çš„é…ç½®ç®¡ç†æ¥å£"""
    
    def __init__(self, config_file: str):
        self.config_file = Path(config_file)
        self.config: Dict[str, Any] = {}
        self._watchers: List[ConfigWatcher] = []
    
    def get_config(self, key: str, default: Any = None) -> Any:
        """è·å–é…ç½®å€¼ï¼Œæ”¯æŒç‚¹å·åˆ†éš”çš„åµŒå¥—é”®"""
        return self._get_nested_value(self.config, key, default)
    
    def set_config(self, key: str, value: Any):
        """è®¾ç½®é…ç½®å€¼å¹¶é€šçŸ¥è§‚å¯Ÿè€…"""
        self._set_nested_value(self.config, key, value)
        self._notify_watchers(key, value)
    
    def watch_config(self, key: str, callback: Callable):
        """ç›‘å¬é…ç½®å˜æ›´"""
        self._watchers.append(ConfigWatcher(key, callback))
```

#### å¹³å°å·¥å‚æ¨¡å—
```python
class PlatformFactory:
    """å¹³å°å·¥å‚ - åˆ›å»ºå¹³å°ç‰¹å®šçš„å®ç°"""
    
    _instance = None
    _engines: Dict[PlatformType, Type[IFingerprintEngine]] = {}
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    @classmethod
    def register_engine(cls, platform: PlatformType, engine_class: Type[IFingerprintEngine]):
        """æ³¨å†Œå¹³å°å¼•æ“"""
        cls._engines[platform] = engine_class
    
    def get_fingerprint_engine(self) -> IFingerprintEngine:
        """è·å–å½“å‰å¹³å°çš„æŒ‡çº¹è¯†åˆ«å¼•æ“"""
        platform = self.get_current_platform()
        engine_class = self._engines.get(platform)
        
        if engine_class is None:
            raise UnsupportedPlatformError(f"ä¸æ”¯æŒçš„å¹³å°: {platform}")
        
        return engine_class()
```

#### å®‰å…¨ç¡®è®¤æ¨¡å—
```python
class ConfirmationSystem:
    """ä¸‰çº§ç¡®è®¤ç³»ç»Ÿ"""
    
    def __init__(self):
        self.confirmation_levels = [
            BasicConfirmation(),
            RiskConfirmation(),
            FinalConfirmation()
        ]
    
    async def confirm_operation(self, operation: Operation) -> bool:
        """æ‰§è¡Œä¸‰çº§ç¡®è®¤æµç¨‹"""
        for level, confirmation in enumerate(self.confirmation_levels, 1):
            result = await confirmation.confirm(operation)
            
            if not result.confirmed:
                self.logger.info(f"ç”¨æˆ·åœ¨ç¬¬{level}çº§ç¡®è®¤ä¸­å–æ¶ˆæ“ä½œ")
                return False
            
            if result.requires_additional_info:
                operation.additional_info.update(result.additional_info)
        
        return True
```

### æ•°æ®æ¨¡å‹è®¾è®¡

#### ç½‘ç»œé€‚é…å™¨æ¨¡å‹
```python
@dataclass
class NetworkAdapter:
    """ç½‘ç»œé€‚é…å™¨æ•°æ®æ¨¡å‹"""
    id: str
    name: str
    description: str
    mac_address: str
    ip_addresses: List[str]
    status: AdapterStatus
    adapter_type: AdapterType
    is_physical: bool
    properties: Dict[str, Any] = field(default_factory=dict)
    
    def __post_init__(self):
        """æ•°æ®éªŒè¯å’Œå¤„ç†"""
        self.mac_address = self._normalize_mac_address(self.mac_address)
        self._validate_data()
    
    def _normalize_mac_address(self, mac: str) -> str:
        """æ ‡å‡†åŒ–MACåœ°å€æ ¼å¼"""
        # ç§»é™¤åˆ†éš”ç¬¦å¹¶è½¬æ¢ä¸ºå¤§å†™
        clean_mac = re.sub(r'[:-]', '', mac).upper()
        # æ·»åŠ å†’å·åˆ†éš”ç¬¦
        return ':'.join(clean_mac[i:i+2] for i in range(0, 12, 2))
    
    def to_dict(self) -> Dict[str, Any]:
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼"""
        return asdict(self)
    
    @classmethod
    def from_dict(cls, data: Dict[str, Any]) -> 'NetworkAdapter':
        """ä»å­—å…¸åˆ›å»ºå®ä¾‹"""
        return cls(**data)
```

---

## æ•°æ®æµè®¾è®¡

### æ•°æ®æµå‘å›¾
```
ç”¨æˆ·æ“ä½œ â†’ UIæ§ä»¶ â†’ æ§åˆ¶å™¨ â†’ ä¸šåŠ¡æœåŠ¡ â†’ å¹³å°å¼•æ“ â†’ ç³»ç»ŸAPI
    â†“         â†“        â†“        â†“         â†“         â†“
çŠ¶æ€æ›´æ–° â† UIæ›´æ–° â† ç»“æœå¤„ç† â† æ•°æ®è½¬æ¢ â† å¹³å°é€‚é… â† ç³»ç»Ÿå“åº”
```

### å…¸å‹æ“ä½œæµç¨‹

#### MACåœ°å€ä¿®æ”¹æµç¨‹
```python
async def modify_mac_address_flow(adapter_id: str, new_mac: str):
    """MACåœ°å€ä¿®æ”¹å®Œæ•´æµç¨‹"""
    
    # 1. æ•°æ®éªŒè¯
    validator = MacAddressValidator()
    if not validator.validate(new_mac):
        raise ValidationError("MACåœ°å€æ ¼å¼æ— æ•ˆ")
    
    # 2. æƒé™æ£€æŸ¥
    permission_manager = get_permission_manager()
    if not permission_manager.check_admin_privileges():
        raise PermissionError("éœ€è¦ç®¡ç†å‘˜æƒé™")
    
    # 3. åˆ›å»ºå¤‡ä»½
    backup_manager = get_backup_manager()
    backup_result = await backup_manager.create_backup(
        BackupType.NETWORK_CONFIG,
        f"ä¿®æ”¹MACåœ°å€å‰å¤‡ä»½_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
    )
    
    if not backup_result.success:
        raise BackupError("å¤‡ä»½åˆ›å»ºå¤±è´¥")
    
    # 4. ä¸‰çº§ç¡®è®¤
    operation = ModifyMacOperation(adapter_id, new_mac)
    confirmation_system = ConfirmationSystem()
    
    if not await confirmation_system.confirm_operation(operation):
        return OperationResult(success=False, message="ç”¨æˆ·å–æ¶ˆæ“ä½œ")
    
    # 5. æ‰§è¡Œä¿®æ”¹
    fingerprint_engine = get_fingerprint_engine()
    modify_result = await fingerprint_engine.modify_mac_address(adapter_id, new_mac)
    
    # 6. éªŒè¯ç»“æœ
    if modify_result.success:
        # éªŒè¯ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆ
        updated_adapter = fingerprint_engine.get_network_adapter(adapter_id)
        if updated_adapter.mac_address.upper() == new_mac.upper():
            return OperationResult(success=True, message="MACåœ°å€ä¿®æ”¹æˆåŠŸ")
        else:
            return OperationResult(success=False, message="ä¿®æ”¹æœªç”Ÿæ•ˆï¼Œè¯·æ£€æŸ¥ç³»ç»ŸçŠ¶æ€")
    else:
        return OperationResult(success=False, message=modify_result.error_message)
```

---

## å®‰å…¨æ¶æ„

### å®‰å…¨è®¾è®¡åŸåˆ™

#### 1. çºµæ·±é˜²å¾¡
```
ç”¨æˆ·ç•Œé¢ â†’ è¾“å…¥éªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ ä¸‰çº§ç¡®è®¤ â†’ å¤‡ä»½ä¿æŠ¤ â†’ æ“ä½œæ‰§è¡Œ
    â†“         â†“         â†“         â†“         â†“         â†“
å®‰å…¨æç¤º   æ•°æ®æ ¡éªŒ   æƒé™éªŒè¯   é£é™©è¯„ä¼°   æ•°æ®ä¿æŠ¤   æ“ä½œå®¡è®¡
```

#### 2. æœ€å°æƒé™åŸåˆ™
- ä»…åœ¨å¿…è¦æ—¶è¯·æ±‚ç®¡ç†å‘˜æƒé™
- æƒé™æ£€æŸ¥è´¯ç©¿æ•´ä¸ªæ“ä½œæµç¨‹
- æ“ä½œå®ŒæˆååŠæ—¶é‡Šæ”¾æƒé™

#### 3. å®Œæ•´æ€§ä¿æŠ¤
```python
class IntegrityManager:
    """å®Œæ•´æ€§ç®¡ç†å™¨"""
    
    def __init__(self):
        self.hash_algorithm = hashlib.sha256
    
    def calculate_checksum(self, data: bytes) -> str:
        """è®¡ç®—æ•°æ®æ ¡éªŒå’Œ"""
        return self.hash_algorithm(data).hexdigest()
    
    def verify_backup_integrity(self, backup_file: Path) -> bool:
        """éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§"""
        try:
            with open(backup_file, 'rb') as f:
                data = f.read()
            
            # ä»æ–‡ä»¶åæˆ–å…ƒæ•°æ®ä¸­è·å–é¢„æœŸæ ¡éªŒå’Œ
            expected_checksum = self._get_expected_checksum(backup_file)
            actual_checksum = self.calculate_checksum(data)
            
            return expected_checksum == actual_checksum
        except Exception as e:
            self.logger.error(f"å®Œæ•´æ€§éªŒè¯å¤±è´¥: {e}")
            return False
```

### å®¡è®¡æ—¥å¿—è®¾è®¡
```python
class AuditLogger:
    """å®¡è®¡æ—¥å¿—è®°å½•å™¨"""
    
    def __init__(self):
        self.audit_log = get_logger("audit")
    
    def log_operation(self, operation: Operation, result: OperationResult):
        """è®°å½•æ“ä½œå®¡è®¡æ—¥å¿—"""
        audit_entry = {
            "timestamp": datetime.now().isoformat(),
            "user": self._get_current_user(),
            "operation": operation.type,
            "target": operation.target,
            "parameters": operation.parameters,
            "result": result.success,
            "message": result.message,
            "risk_level": operation.risk_level,
            "confirmation_levels": operation.confirmation_levels
        }
        
        self.audit_log.info(json.dumps(audit_entry, ensure_ascii=False))
```

---

## æ€§èƒ½è®¾è®¡

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. ç¼“å­˜æœºåˆ¶
```python
class CacheManager:
    """ç¼“å­˜ç®¡ç†å™¨"""
    
    def __init__(self, max_size: int = 1000, ttl: int = 300):
        self.cache: Dict[str, CacheEntry] = {}
        self.max_size = max_size
        self.ttl = ttl  # ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰
    
    def get(self, key: str) -> Optional[Any]:
        """è·å–ç¼“å­˜å€¼"""
        entry = self.cache.get(key)
        
        if entry is None:
            return None
        
        if time.time() - entry.timestamp > self.ttl:
            del self.cache[key]
            return None
        
        entry.access_count += 1
        entry.last_access = time.time()
        return entry.value
    
    def set(self, key: str, value: Any):
        """è®¾ç½®ç¼“å­˜å€¼"""
        if len(self.cache) >= self.max_size:
            self._evict_lru()
        
        self.cache[key] = CacheEntry(
            value=value,
            timestamp=time.time(),
            access_count=1,
            last_access=time.time()
        )
```

#### 2. å¼‚æ­¥å¤„ç†
```python
class AsyncOperationManager:
    """å¼‚æ­¥æ“ä½œç®¡ç†å™¨"""
    
    def __init__(self, max_workers: int = 4):
        self.executor = ThreadPoolExecutor(max_workers=max_workers)
        self.running_operations: Dict[str, Future] = {}
    
    async def execute_async(self, operation: Operation) -> OperationResult:
        """å¼‚æ­¥æ‰§è¡Œæ“ä½œ"""
        operation_id = str(uuid.uuid4())
        
        # æäº¤åˆ°çº¿ç¨‹æ± æ‰§è¡Œ
        future = self.executor.submit(self._execute_operation, operation)
        self.running_operations[operation_id] = future
        
        try:
            # ç­‰å¾…æ“ä½œå®Œæˆ
            result = await asyncio.wrap_future(future)
            return result
        finally:
            # æ¸…ç†å®Œæˆçš„æ“ä½œ
            self.running_operations.pop(operation_id, None)
```

#### 3. å†…å­˜ç®¡ç†
```python
class MemoryManager:
    """å†…å­˜ç®¡ç†å™¨"""
    
    def __init__(self, max_memory_mb: int = 512):
        self.max_memory_bytes = max_memory_mb * 1024 * 1024
        self.memory_monitor = MemoryMonitor()
    
    def check_memory_usage(self):
        """æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ"""
        current_usage = self.memory_monitor.get_current_usage()
        
        if current_usage > self.max_memory_bytes:
            self._trigger_garbage_collection()
            self._clear_caches()
    
    def _trigger_garbage_collection(self):
        """è§¦å‘åƒåœ¾å›æ”¶"""
        import gc
        collected = gc.collect()
        self.logger.debug(f"åƒåœ¾å›æ”¶é‡Šæ”¾äº† {collected} ä¸ªå¯¹è±¡")
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶æ¶æ„
```python
class PluginManager:
    """æ’ä»¶ç®¡ç†å™¨"""
    
    def __init__(self):
        self.plugins: Dict[str, Plugin] = {}
        self.plugin_hooks: Dict[str, List[Callable]] = {}
    
    def register_plugin(self, plugin: Plugin):
        """æ³¨å†Œæ’ä»¶"""
        self.plugins[plugin.name] = plugin
        
        # æ³¨å†Œæ’ä»¶çš„é’©å­å‡½æ•°
        for hook_name, hook_func in plugin.get_hooks().items():
            if hook_name not in self.plugin_hooks:
                self.plugin_hooks[hook_name] = []
            self.plugin_hooks[hook_name].append(hook_func)
    
    def execute_hook(self, hook_name: str, *args, **kwargs):
        """æ‰§è¡Œé’©å­å‡½æ•°"""
        hooks = self.plugin_hooks.get(hook_name, [])
        results = []
        
        for hook in hooks:
            try:
                result = hook(*args, **kwargs)
                results.append(result)
            except Exception as e:
                self.logger.error(f"æ’ä»¶é’©å­æ‰§è¡Œå¤±è´¥: {e}")
        
        return results
```

### å¹³å°æ‰©å±•æœºåˆ¶
```python
# æ–°å¹³å°æ”¯æŒåªéœ€å®ç°æ¥å£
class NewPlatformFingerprintEngine(IFingerprintEngine):
    """æ–°å¹³å°æŒ‡çº¹è¯†åˆ«å¼•æ“"""
    
    def get_network_adapters(self) -> List[NetworkAdapter]:
        """å®ç°æ–°å¹³å°çš„ç½‘ç»œé€‚é…å™¨è·å–é€»è¾‘"""
        pass
    
    def modify_mac_address(self, adapter_id: str, new_mac: str) -> bool:
        """å®ç°æ–°å¹³å°çš„MACåœ°å€ä¿®æ”¹é€»è¾‘"""
        pass

# æ³¨å†Œæ–°å¹³å°
PlatformFactory.register_engine(
    PlatformType.NEW_PLATFORM,
    NewPlatformFingerprintEngine
)
```

### åŠŸèƒ½æ‰©å±•æ¥å£
```python
class FeatureExtension(ABC):
    """åŠŸèƒ½æ‰©å±•åŸºç±»"""
    
    @abstractmethod
    def get_name(self) -> str:
        """è·å–æ‰©å±•åç§°"""
        pass
    
    @abstractmethod
    def get_description(self) -> str:
        """è·å–æ‰©å±•æè¿°"""
        pass
    
    @abstractmethod
    def initialize(self, context: ExtensionContext):
        """åˆå§‹åŒ–æ‰©å±•"""
        pass
    
    @abstractmethod
    def execute(self, parameters: Dict[str, Any]) -> ExtensionResult:
        """æ‰§è¡Œæ‰©å±•åŠŸèƒ½"""
        pass
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘æŒ‡å—](development-guide.md) - å¼€å‘ç¯å¢ƒå’Œæµç¨‹
- [APIå‚è€ƒ](api-reference.md) - æ¥å£æ–‡æ¡£å’Œç¤ºä¾‹
- [éƒ¨ç½²æŒ‡å—](../deployment/deployment-guide.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

**æœ€åæ›´æ–°**ï¼š2024å¹´1æœˆ15æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0
